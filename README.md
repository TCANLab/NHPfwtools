# NHPfwtools
Attached are a set of tools that were developed by the Translational Cognitive and Affective Neuroscience lab (lead PI: Cameron Carter) to process multi-shell diffusion data. The code in the current iteration is heavily customized to run on servers at the Imaging Research Center at UC Davis and specifically for nonhuman primate data.  While these tools handle DTI data preprocessing, particular scripts, such as the report_masked_tF_data.sh and report_masked_tFA_data.sh rely upon use of free tools hosted at https://github.com/NIRALUser (e.g. AutoSeg, NeoSeg, dtiprep/dmriprep) to prepare segment and parcellate structural data and find artifacts in diffusion data.  To successfully use these tools the user will need to have FSL, ANTS, Slicer3D, and Dipy toolbox already installed on their machine.

Please read the license before using, these tools are provided AS-IS, with no guarantee, and will be updated as needed.

The tools and their uses are as follows:

batch_dtiprep_QA.sh: This script first converts raw dicom data to the NRRD format, then runs DTIprep software to evaluate data quality based on the protocol.xml file that is created by the user.

preproc_dwidata_NHP.sh: This script converts data to nifti format, allows the user to specify which volumes should be discarded (based on dtiprep and manual QC), performs FSL topup using opposing phase encoding images, eddy corrects data using FSL eddy, and prepares data to be submitted to code for fitting diffusion models.

Dipy_fit_nhp.py: This script takes data generated by "preproc_dwidata_NHP.sh" and fits diffusion metrics to the data using the Dipy toolbox (see https://dipy.org/documentation/1.0.0./examples_built/reconst_fwdti/).

DTI_to_T2_ants.sh: This script uses the ANTS software package (http://stnava.github.io/ANTs/) to nonlinearly align diffusion data to the individual subjects T2 structural image in preparation for extracting diffusion measures from regions of interest.

report_masked_tF_data.sh and report_masked_tFA_data.sh: These tools use segmented and parcellated region of interest masks generated with tools such as AutoSeg and NeoSeg (https://github.com/NIRALUser).  Extracellular free water and tFA data are computed for each mask and exported to a text file.
